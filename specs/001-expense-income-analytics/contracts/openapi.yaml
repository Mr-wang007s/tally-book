openapi: 3.0.3
info:
  title: Personal Bookkeeping API
  version: 0.1.0
  description: Transactions CRUD, summaries, and trends for expense/income analytics.
servers:
  - url: https://api.example.com
paths:
  /transactions:
    get:
      summary: List transactions
      parameters:
        - in: query
          name: from
          schema: { type: string, format: date }
        - in: query
          name: to
          schema: { type: string, format: date }
        - in: query
          name: type
          schema: { type: string, enum: [expense, income] }
        - in: query
          name: categoryId
          schema: { type: string }
        - in: query
          name: minAmount
          schema: { type: number }
        - in: query
          name: maxAmount
          schema: { type: number }
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: sort
          schema: { type: string, enum: [date_desc, date_asc, amount_desc, amount_asc] }
        - in: query
          name: page
          schema: { type: integer, minimum: 1, default: 1 }
        - in: query
          name: pageSize
          schema: { type: integer, minimum: 1, maximum: 200, default: 20 }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Transaction'
                  total:
                    type: integer
    post:
      summary: Create transaction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransactionCreate'
      responses:
        '201': { description: Created, content: { application/json: { schema: { $ref: '#/components/schemas/Transaction' } } } }
  /transactions/{id}:
    get:
      summary: Get transaction
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: OK, content: { application/json: { schema: { $ref: '#/components/schemas/Transaction' } } } }
        '404': { description: Not Found }
    patch:
      summary: Update transaction
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransactionUpdate'
      responses:
        '200': { description: OK, content: { application/json: { schema: { $ref: '#/components/schemas/Transaction' } } } }
        '404': { description: Not Found }
    delete:
      summary: Delete transaction
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '204': { description: No Content }
        '404': { description: Not Found }
  /analytics/summary:
    get:
      summary: Period summary totals
      parameters:
        - in: query
          name: from
          schema: { type: string, format: date }
        - in: query
          name: to
          schema: { type: string, format: date }
        - in: query
          name: granularity
          schema: { type: string, enum: [day, week, month, year] }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PeriodSummary'
  /analytics/category-breakdown:
    get:
      summary: Category breakdown during a period
      parameters:
        - in: query
          name: from
          schema: { type: string, format: date }
        - in: query
          name: to
          schema: { type: string, format: date }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/CategoryBreakdownItem'
  /analytics/trend:
    get:
      summary: Trend over time
      parameters:
        - in: query
          name: from
          schema: { type: string, format: date }
        - in: query
          name: to
          schema: { type: string, format: date }
        - in: query
          name: granularity
          schema: { type: string, enum: [day, week, month, year] }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  points:
                    type: array
                    items:
                      $ref: '#/components/schemas/TrendPoint'

components:
  schemas:
    Transaction:
      type: object
      required: [id, type, amount, currency, date]
      properties:
        id: { type: string }
        type: { type: string, enum: [expense, income] }
        amount: { type: number, minimum: 0.01, maximum: 1000000 }
        currency: { type: string }
        date: { type: string, format: date-time }
        categoryId: { type: string, nullable: true }
        notes: { type: string, maxLength: 500 }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
    TransactionCreate:
      type: object
      required: [type, amount, date]
      properties:
        type: { type: string, enum: [expense, income] }
        amount: { type: number, minimum: 0.01, maximum: 1000000 }
        currency: { type: string }
        date: { type: string, format: date-time }
        categoryId: { type: string, nullable: true }
        notes: { type: string, maxLength: 500 }
    TransactionUpdate:
      type: object
      properties:
        type: { type: string, enum: [expense, income] }
        amount: { type: number, minimum: 0.01, maximum: 1000000 }
        currency: { type: string }
        date: { type: string, format: date-time }
        categoryId: { type: string, nullable: true }
        notes: { type: string, maxLength: 500 }
    PeriodSummary:
      type: object
      properties:
        totalExpense: { type: number }
        totalIncome: { type: number }
        net: { type: number }
    CategoryBreakdownItem:
      type: object
      properties:
        categoryId: { type: string }
        amount: { type: number }
        percentage: { type: number, minimum: 0, maximum: 100 }
    TrendPoint:
      type: object
      properties:
        periodStart: { type: string, format: date }
        periodEnd: { type: string, format: date }
        totalExpense: { type: number }
        totalIncome: { type: number }
        net: { type: number }
