# Feature Specification: 家庭支出统计应用

**Feature Branch**: `001-expense-tracking-app`  
**Created**: 2025-11-15  
**Status**: Draft  
**Input**: User description: "建立一个app,可以帮我做家庭支出统计，支持键盘输入、语音输入、拍照图片输入。语音和拍照输入可以自动识别支出金额和类型，并能帮我做支持趋势统计"  
**Updated**: 2025-11-15 - 移除手写输入，改为键盘输入

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 快速键盘输入记账 (Priority: P1)

用户可以通过标准键盘输入框快速输入支出信息（金额、类别、备注），系统提供智能类别建议和金额格式化。这是最基础的记账功能，让用户能够快速、准确地记录任何支出。

**Why this priority**: 这是应用的核心价值 - 让记账变得快速简便。键盘输入是最通用和精确的输入方式，用户可以快速输入准确的金额和类别信息。这是 MVP 的基础功能，所有用户都熟悉并能轻松使用。

**Independent Test**: 用户打开应用，点击"添加支出"按钮，在金额输入框输入"50"，在类别选择器中选择"餐饮"，可选填写备注"午餐"，点击保存后记录出现在支出列表顶部。可以通过查看列表验证记录成功保存。

**Acceptance Scenarios**:

1. **Given** 用户打开应用主界面，**When** 用户点击"添加支出"按钮并输入金额"80"、选择类别"餐饮"，**Then** 系统创建一条支出记录并显示在当日支出列表顶部
2. **Given** 用户输入金额时，**When** 用户输入"1234"，**Then** 系统自动格式化显示为"1,234.00"并验证格式正确性
3. **Given** 用户完成输入后，**When** 用户点击"保存"按钮，**Then** 记录立即保存到本地存储，并更新今日总支出统计
4. **Given** 用户输入了无效金额（如负数或非数字），**When** 用户尝试保存，**Then** 系统显示错误提示"请输入有效金额"并阻止保存
5. **Given** 用户开始输入类别关键词，**When** 用户输入"餐"，**Then** 系统显示相关类别建议（餐饮、快餐等）供快速选择
6. **Given** 用户使用键盘输入，**When** 焦点在金额输入框，**Then** 系统自动弹出数字键盘便于输入

---

### User Story 2 - 语音快速记账 (Priority: P1)

用户可以通过语音说出支出信息（如"打车回家花了30元"），系统自动识别金额和类别并创建记录。这为用户提供了完全解放双手的记账方式，特别适合在移动场景下使用。

**Why this priority**: 语音输入是现代移动应用的标配功能，对于忙碌的用户来说是最快的输入方式。在开车、购物、带孩子等双手不便的场景下，语音记账可以确保不遗漏任何支出。这与键盘输入同为 P1，因为它们都是核心输入方式。

**Independent Test**: 用户打开语音输入功能，说"早餐面包牛奶15块"，系统识别后自动创建餐饮类支出15元的记录。可以通过查看当日记录列表验证记录成功。

**Acceptance Scenarios**:

1. **Given** 用户点击语音输入按钮，**When** 用户说"超市买水果花了45元"，**Then** 系统创建食品类支出记录45元
2. **Given** 用户说出方言或带有口音的普通话，**When** 系统进行语音识别，**Then** 系统能够正确识别常见方言词汇并提取金额和类别信息
3. **Given** 噪音环境下用户进行语音输入，**When** 识别准确率下降，**Then** 系统显示识别结果并提供手动修正选项
4. **Given** 用户说出复杂描述（如"今天中午和朋友聚餐AA制我付了120"），**When** 系统处理语音，**Then** 提取金额120元和餐饮类别，忽略无关描述信息

---

### User Story 3 - 拍照识别账单 (Priority: P2)

用户可以拍摄购物小票、发票或收据照片，系统自动识别照片中的金额和消费类别，并创建支出记录。这为用户提供了最直观的记账方式，并可以保留消费凭证。

**Why this priority**: 拍照识别是智能记账的高级功能，可以大幅提升用户体验。虽然不如键盘和语音紧急（用户可以先手动记录后补充照片），但它提供了独特价值：自动存档消费凭证，方便日后核对和报销。设为 P2 是因为需要更复杂的 OCR 技术。

**Independent Test**: 用户拍摄一张超市小票照片，系统识别出总金额和商品类别（如食品、日用品），自动创建对应的支出记录，照片作为附件保存。用户可以在记录详情中查看原始照片。

**Acceptance Scenarios**:

1. **Given** 用户点击拍照按钮，**When** 用户拍摄一张清晰的购物小票，**Then** 系统识别出总金额、商家名称、消费日期，并自动分类为对应类别
2. **Given** 用户拍摄的照片模糊或光线不足，**When** 系统进行 OCR 识别，**Then** 提示用户重新拍摄或手动输入关键信息
3. **Given** 小票包含多个商品项目，**When** 系统识别完成，**Then** 用户可以选择记录总金额或拆分为多条明细记录
4. **Given** 用户拍摄了非中文小票（如英文发票），**When** 系统识别语言，**Then** 系统能够识别英文数字金额和常见类别词汇
5. **Given** 照片识别完成后，**When** 用户查看记录详情，**Then** 可以看到原始照片缩略图，点击可放大查看完整照片

---

### User Story 4 - 支出趋势统计与可视化 (Priority: P2)

用户可以查看不同时间维度（日、周、月、年）的支出统计，包括总金额、分类占比、趋势变化等。系统以图表形式展示数据，帮助用户了解消费习惯和趋势。

**Why this priority**: 统计分析是记账应用的核心价值之一，但需要先有数据积累才有意义。设为 P2 是因为用户需要先完成 P1 的记账功能积累数据后，才能充分利用统计功能。但这是应用的重要卖点，需要尽早实现。

**Independent Test**: 用户记录了一周的支出数据后，打开统计页面，可以看到本周总支出、每日支出折线图、各类别支出饼图、与上周对比的趋势箭头。用户可以切换到月度视图查看本月统计。

**Acceptance Scenarios**:

1. **Given** 用户已有至少7天的支出记录，**When** 用户打开"统计"标签页，**Then** 显示本周总支出、平均日支出、最高单日支出
2. **Given** 用户查看月度统计，**When** 用户点击某个类别（如餐饮），**Then** 显示该类别的详细支出明细和趋势图
3. **Given** 用户查看趋势图表，**When** 用户点击图表中的某个数据点（如某一天），**Then** 显示该天的详细支出列表
4. **Given** 用户想对比不同时间段，**When** 用户选择"月度对比"功能，**Then** 显示过去3个月或6个月的支出对比柱状图
5. **Given** 用户支出数据不足（如只有1-2天数据），**When** 用户打开统计页面，**Then** 显示友好提示"继续记录更多数据以查看有意义的统计分析"

---

### User Story 5 - 支出分类管理 (Priority: P3)

用户可以自定义支出类别，添加、编辑、删除类别，并为每个类别设置图标和预算。系统提供默认类别（餐饮、交通、购物、娱乐等），用户可以根据个人需求调整。

**Why this priority**: 分类管理是增强个性化体验的功能，但对 MVP 不是必需的。系统可以先提供固定的默认分类，用户也能正常使用。设为 P3 是因为这是优化和个性化功能，可以在核心功能稳定后再实现。

**Independent Test**: 用户打开"分类管理"页面，可以看到所有默认类别。用户添加一个新类别"医疗"并为其选择图标，然后在记账时可以在类别列表中看到并选择"医疗"。

**Acceptance Scenarios**:

1. **Given** 用户打开分类管理界面，**When** 用户点击"添加分类"，**Then** 可以输入类别名称、选择图标、设置月度预算（可选）
2. **Given** 用户创建了自定义类别，**When** 用户在记账时选择类别，**Then** 自定义类别出现在类别列表中供选择
3. **Given** 用户想删除某个自定义类别，**When** 用户执行删除操作，**Then** 系统提示"该类别下已有X条记录，删除后记录将归入'其他'类别"并要求确认
4. **Given** 用户为某个类别设置了月度预算（如餐饮3000元），**When** 当月该类别支出超过预算的80%，**Then** 系统发送提醒通知

---

### Edge Cases

- **无效金额输入**: 当用户输入非数字字符、负数或超过限额时，系统显示错误提示"请输入0-1,000,000之间的有效金额"
- **空字段提交**: 当用户未填写必填字段（金额或类别）就尝试保存时，系统高亮显示缺失字段并提示"请完成所有必填信息"
- **语音识别歧义**: 当用户说"买了两只鸡"时，系统可能无法区分是"2只"还是"两支"（笔），需要智能判断上下文或提供选项让用户确认
- **拍照识别多张小票**: 当用户一次拍摄包含多张小票的照片时，系统提示"检测到多张小票，请分别拍摄"或提供区域选择工具
- **离线使用**: 当用户在无网络环境下使用应用时，键盘输入功能正常工作；语音和拍照识别提示"识别功能需要网络连接，已保存原始数据，联网后自动识别"
- **数据同步**: 如果用户更换设备或重装应用，如何恢复历史数据？需要云端备份或导出/导入功能
- **异常金额**: 当用户输入异常大的金额（如100000元）时，系统显示确认提示"检测到大额支出，请确认金额是否正确"
- **时区问题**: 当用户跨时区旅行时，记录的时间应该使用哪个时区？默认使用设备当前时区
- **并发记录**: 当用户快速连续添加多条记录时（如键盘输入后立即语音输入），系统如何保证不丢失数据和正确的时间戳排序
- **存储限制**: 当用户拍照记录积累过多导致存储空间不足时，系统提示用户清理旧照片或提供云端存储选项
- **键盘遮挡**: 当键盘弹出时，输入表单被遮挡，系统自动滚动页面确保输入框可见
- **快速输入优化**: 用户连续记录多笔支出时，系统记住上次选择的类别作为默认值，减少重复操作

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须提供标准键盘输入表单，包含金额输入框（数字键盘）、类别选择器和可选备注字段
- **FR-002**: 系统必须支持语音输入识别，能够将语音转换为文本并自动提取金额和类别信息
- **FR-003**: 系统必须支持拍照识别功能，通过 OCR 技术识别购物小票、发票中的金额、日期、商家信息
- **FR-004**: 系统必须自动将识别出的支出信息分类到预定义类别（餐饮、交通、购物、娱乐、医疗、教育、住房、其他）
- **FR-005**: 系统必须将所有支出记录持久化保存到本地存储，确保数据不丢失
- **FR-006**: 系统必须提供支出记录列表视图，按时间倒序显示（最新记录在前），支持按日期筛选
- **FR-007**: 系统必须提供统计分析功能，支持日、周、月、年四个时间维度的统计
- **FR-008**: 系统必须以图表形式展示统计数据，包括折线图（趋势）、饼图（分类占比）、柱状图（对比）
- **FR-009**: 系统必须在用户语音输入后显示识别结果，允许用户在保存前修正错误
- **FR-010**: 系统必须验证金额格式，仅接受正数且不超过100万元的金额输入，并自动格式化显示（如 1,234.56）
- **FR-011**: 所有文本元素必须支持动态字体（Dynamic Type），允许用户调整文字大小（Constitution Principle I）
- **FR-012**: 所有交互元素必须提供辅助功能标签（`accessibilityLabel` 和 `accessibilityRole`），支持 VoiceOver 导航（Principle IV）
- **FR-013**: 应用必须支持浅色和深色模式，所有颜色通过主题系统定义（Principle VI）
- **FR-014**: 所有可点击元素的触摸目标必须 ≥44x44 点（Principle IV）
- **FR-015**: 应用必须使用 SafeAreaView 确保内容不被刘海或主页指示器遮挡（Principle VII）
- **FR-016**: 列表滚动和页面转场动画必须保持 ≥60fps 流畅度（Principle V）
- **FR-017**: 系统必须提供离线使用能力，键盘输入功能完全离线可用；语音和拍照识别可延迟到联网后执行
- **FR-018**: 系统必须使用 `@expo/vector-icons` 提供的图标，避免不必要的自定义图标（Principle I）
- **FR-019**: 拍照功能必须支持从相册选择已有照片，不仅限于实时拍摄
- **FR-020**: 系统必须为每条支出记录自动记录创建时间戳和可选的备注字段
- **FR-021**: 系统必须在键盘弹出时使用 KeyboardAvoidingView 确保输入框不被遮挡（Principle VII）
- **FR-022**: 系统必须为类别选择提供快速搜索或筛选功能，方便用户快速找到目标类别
- **FR-023**: 系统必须在金额输入框聚焦时自动弹出数字键盘，提升输入效率

### Key Entities

- **Expense（支出记录）**: 代表一次支出事件
  - 核心属性：金额（amount）、类别（category）、日期时间（timestamp）、创建方式（键盘/语音/拍照）
  - 可选属性：备注（note）、照片附件（photoUri）、商家名称（merchant）、原始识别文本（rawText）
  - 关系：属于某个类别（Category）

- **Category（支出类别）**: 代表支出的分类
  - 核心属性：类别名称（name）、图标（icon）、颜色（color）
  - 可选属性：月度预算（monthlyBudget）、是否为系统默认类别（isDefault）
  - 关系：包含多个支出记录（Expenses）

- **Statistics（统计数据）**: 代表某个时间段的统计结果（计算得出，不持久化存储）
  - 属性：时间范围（startDate, endDate）、总支出（totalAmount）、平均值（averageAmount）、分类汇总（categoryBreakdown）、趋势数据（trendData）

- **RecognitionResult（识别结果）**: 代表一次语音/OCR 识别的临时结果
  - 属性：识别文本（text）、置信度（confidence）、提取的金额（extractedAmount）、提取的类别（extractedCategory）、识别状态（pending/success/failed）

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户可以在5秒内完成一次键盘支出记录（从打开输入界面到保存成功）
- **SC-002**: 应用冷启动到首屏可交互时间 <3 秒（在中端 Android 设备上测试）
- **SC-003**: 语音识别准确率 ≥90%（在安静环境、标准普通话条件下）
- **SC-004**: 拍照 OCR 识别准确率 ≥80%（针对清晰完整的小票照片）
- **SC-005**: 100% 的 P1 用户流程支持 VoiceOver 无障碍导航
- **SC-006**: 所有交互界面颜色对比度符合 WCAG AA 标准（≥4.5:1）
- **SC-007**: 90% 的新用户能在首次使用时成功添加至少一条支出记录（无需查看帮助文档）
- **SC-008**: 统计图表渲染时间 <1 秒（包含100条以内的记录数据）
- **SC-009**: 应用捆绑包大小 <30MB（生产构建）
- **SC-010**: 用户每日平均记账次数 ≥2 次（表示应用成功融入日常使用场景）
- **SC-011**: 用户记账成功率 ≥95%（成功保存的记录数 / 尝试添加的记录数）
- **SC-012**: 键盘输入模式下，用户从打开输入表单到完成一条记录的平均时间 ≤8 秒
- **SC-013**: 测试覆盖率 ≥90%（针对所有自定义 Hooks 和业务逻辑函数）
- **SC-014**: 表单验证响应时间 <100ms（用户输入后立即显示验证反馈）

## Assumptions

以下是基于行业标准和常见实践做出的合理假设：

1. **货币单位**: 默认使用人民币（CNY），金额单位为元。暂不支持多币种
2. **数据存储**: 使用本地存储（AsyncStorage 或 SQLite），初期不提供云同步功能
3. **识别服务**: 语音、OCR 识别使用在线 API 服务（如百度 AI、腾讯云、讯飞等），需要网络连接。离线时记录原始输入，联网后处理
4. **隐私保护**: 所有数据仅存储在用户设备本地，不上传到服务器（识别 API 调用除外）
5. **用户认证**: 初期不需要用户账号登录，应用可直接使用。可选支持设备本地密码保护
6. **数据备份**: 用户可通过导出 JSON 或 CSV 文件手动备份数据
7. **性能目标**: 基于中端移动设备（iPhone 8 或同级 Android 设备）设定性能标准
8. **支持语言**: 初期仅支持简体中文界面和中文输入识别
9. **照片存储**: 拍照记录的照片压缩后存储在本地，单张照片不超过 1MB
10. **统计时间范围**: 默认显示最近30天数据，用户可查询历史任意时间段
11. **分类数量**: 系统提供8个默认分类，用户可自定义添加最多20个分类
12. **记录数量限制**: 应用可支持至少10000条历史记录而不影响性能
13. **输入验证**: 金额输入支持小数点后两位，自动四舍五入到分
14. **键盘类型**: 金额输入框使用数字键盘（带小数点），备注字段使用标准键盘
