# Feature Specification: iOS 风格视觉改版

**Feature Branch**: `003-ios-visual-redesign`  
**Created**: 2025-11-15  
**Status**: Draft  
**Input**: User description: "根据当前交互，做一版新的视觉稿，参考 Apple iOS 设计语言"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 首屏视觉焕新体验 (Priority: P1)

用户打开记账应用时，立即感受到简约、流畅的 iOS 风格界面，包括精致的卡片设计、柔和的圆角、通透的毛玻璃效果和舒适的间距布局。

**Why this priority**: 首屏是用户第一印象，直接影响留存率和使用意愿。iOS 风格的视觉升级能显著提升品牌认知和用户信任感。

**Independent Test**: 用户启动应用后，通过视觉对比（改版前后截图）验证 iOS 设计语言的核心元素是否呈现，包括 SF Symbols 图标、8pt 网格间距、柔和阴影、卡片圆角等。

**Acceptance Scenarios**:

1. **Given** 用户打开应用, **When** 进入交易列表页, **Then** 看到使用 12pt 圆角的卡片布局，每个交易项带有轻量阴影
2. **Given** 用户查看列表, **When** 滚动交易记录, **Then** 体验流畅的 60fps 滚动动画，卡片间距符合 8pt 网格系统
3. **Given** 用户观察界面, **When** 对比设计元素, **Then** 所有图标使用 SF Symbols 风格（或视觉一致的自定义图标），文字使用 San Francisco 字体系统
4. **Given** 用户切换深色模式, **When** 界面自动适配, **Then** 卡片背景呈现深色毛玻璃效果，文字颜色动态调整保持清晰度

---

### User Story 2 - 交互动画流畅性提升 (Priority: P2)

用户在执行操作（如打开筛选面板、添加交易、删除记录）时，感受到平滑自然的过渡动画和微交互反馈，提升操作的愉悦感和确定性。

**Why this priority**: 流畅的动画是 iOS 体验的核心，直接影响用户对应用品质的感知。过渡动画能减少认知负担，增强操作反馈。

**Independent Test**: 执行关键交互（打开底部面板、点击 FAB、删除交易）时，通过慢动作录屏验证动画曲线是否平滑（贝塞尔缓动），时长是否符合 iOS 标准（0.3-0.4s）。

**Acceptance Scenarios**:

1. **Given** 用户点击筛选按钮, **When** 底部面板展开, **Then** 面板以 0.35s 弹簧动画从底部滑出，背景遮罩淡入，带有毛玻璃模糊效果
2. **Given** 用户点击 FAB, **When** 展开选项菜单, **Then** 三个选项以错开时序（stagger）弹出，每个按钮带有轻微缩放+淡入动画
3. **Given** 用户滑动删除交易, **When** 执行删除操作, **Then** 卡片以淡出+缩小动画消失（0.3s），其他卡片平滑上移填补空位
4. **Given** 用户点击列表项, **When** 触摸反馈触发, **Then** 卡片背景色微妙变化（0.1s），释放后恢复原色

---

### User Story 3 - 数据可视化清晰度优化 (Priority: P2)

用户查看统计数据和分类信息时，看到使用 iOS 设计语言的清晰图表、柔和配色和层次分明的数据展示，快速理解财务状况。

**Why this priority**: 数据可视化是记账应用的核心价值，清晰的视觉呈现能帮助用户更快做出财务决策。

**Independent Test**: 查看统计页面时，验证图表配色是否符合 iOS 动态色彩系统（支持深浅模式），数据层次是否通过字重、字号、颜色明确区分。

**Acceptance Scenarios**:

1. **Given** 用户进入统计页面, **When** 查看收支趋势图, **Then** 图表使用柔和渐变色（非纯色），网格线轻量不突兀，数据标签清晰易读
2. **Given** 用户查看分类占比, **When** 查看饼图或条形图, **Then** 配色符合 iOS 系统色板，每个分类带有图标和百分比标注
3. **Given** 用户切换时间范围, **When** 数据更新, **Then** 图表以淡入淡出动画过渡（0.4s），避免生硬跳转
4. **Given** 用户在深色模式下查看, **When** 观察数据对比度, **Then** 文字和图表元素对比度≥4.5:1，符合 WCAG AA 标准

---

### User Story 4 - 毛玻璃效果层次感 (Priority: P3)

用户在使用浮层组件（筛选面板、确认对话框、操作菜单）时，看到背景实时模糊的毛玻璃效果，增强空间层次感和沉浸感。

**Why this priority**: 毛玻璃效果是 iOS 视觉语言的标志性元素，能显著提升界面的精致度和品牌一致性。

**Independent Test**: 打开任意浮层组件时，截图验证背景是否实时模糊（而非静态遮罩），模糊半径是否适中（不过度影响性能）。

**Acceptance Scenarios**:

1. **Given** 用户打开筛选面板, **When** 面板展开时, **Then** 背后的交易列表呈现高斯模糊效果（模糊半径 20-30pt），面板自身背景半透明
2. **Given** 用户触发删除确认, **When** 对话框弹出, **Then** 对话框背景为浅色/深色毛玻璃材质，对话框投射轻量阴影
3. **Given** 用户点击 FAB 菜单, **When** 选项展开, **Then** 背景遮罩带有轻微模糊，收起时模糊平滑消失
4. **Given** 用户在低端设备上使用, **When** 毛玻璃效果启用, **Then** 帧率保持 ≥45fps，如设备性能不足则优雅降级为半透明纯色

---

### User Story 5 - 深色模式视觉一致性 (Priority: P1)

用户在系统深色模式下使用应用时，所有界面元素自动适配深色主题，保持文字可读性、对比度和视觉舒适度，符合 iOS 深色模式设计规范。

**Why this priority**: 深色模式是 iOS 用户的核心需求，也是 Constitution Principle VI 的强制要求。一致的深色体验能保护用户视力并提升夜间使用体验。

**Independent Test**: 在系统设置中切换深色模式，验证应用是否自动响应，所有颜色是否使用语义化色值（非硬编码），对比度是否符合标准。

**Acceptance Scenarios**:

1. **Given** 用户在浅色模式下使用, **When** 切换系统深色模式, **Then** 应用立即响应（无需重启），背景色切换为深灰/黑色，文字切换为浅色
2. **Given** 用户查看卡片元素, **When** 在深色模式下, **Then** 卡片背景使用深色毛玻璃或 elevated 颜色（#1C1C1E），边框线颜色变浅
3. **Given** 用户查看彩色元素, **When** 在深色模式下, **Then** 分类图标和图表配色自动降低饱和度（避免刺眼），保持可识别性
4. **Given** 用户阅读文字内容, **When** 在深色模式下, **Then** 主文字为 #FFFFFF（或接近白），次要文字为 #EBEBF5（60% 不透明度），对比度≥7:1

---

### Edge Cases

- 用户设备为低端机型（如 iPhone 8）时，毛玻璃效果如何优雅降级以保持 60fps 性能？
- 用户开启系统"增强对比度"或"减少透明度"辅助功能时，界面如何调整？
- 用户使用超大字体（Dynamic Type - XXXL）时，卡片布局如何自适应避免截断？
- 快速切换浅色/深色模式时，动画过渡是否流畅无闪烁？
- 在 iPad 上使用时，卡片宽度和间距如何适配大屏幕？

## Requirements *(mandatory)*

### Functional Requirements

#### 视觉设计核心要求

- **FR-001**: 系统 MUST 采用 8pt 网格系统，所有间距、边距、元素尺寸为 8 的倍数（8pt, 16pt, 24pt, 32pt...）
- **FR-002**: 系统 MUST 为卡片元素使用 12pt 圆角半径（中型组件）或 10pt（小型组件），按钮使用 8pt 圆角
- **FR-003**: 系统 MUST 为浮起的卡片元素添加轻量阴影（偏移 Y: 2pt, 模糊半径 8pt, 不透明度 8%）
- **FR-004**: 系统 MUST 使用 SF Symbols 图标或视觉风格一致的自定义图标（线性风格，2pt 线宽）
- **FR-005**: 系统 MUST 使用 San Francisco 字体系统（iOS 默认），或在 Android 上使用 Roboto 作为等效替代

#### 色彩与主题要求

- **FR-006**: 系统 MUST 使用语义化颜色定义（如 `colors.background`, `colors.text`），禁止硬编码十六进制色值
- **FR-007**: 系统 MUST 支持浅色和深色模式，通过 `useColorScheme` 动态切换（Constitution Principle VI）
- **FR-008**: 深色模式下，系统 MUST 使用深灰色背景（#000000 或 #1C1C1E）而非纯黑，卡片背景为 elevated 颜色（#2C2C2E）
- **FR-009**: 系统 MUST 确保所有文字与背景对比度≥4.5:1（标准文字）或 ≥7:1（小号文字），符合 WCAG AA 标准

#### 动画与交互要求

- **FR-010**: 系统 MUST 为页面过渡使用平滑动画（时长 0.3-0.4s，贝塞尔缓动曲线 cubic-bezier(0.25, 0.1, 0.25, 1)）
- **FR-011**: 系统 MUST 为底部面板展开使用弹簧动画（Spring Animation，阻尼系数 0.8，响应度 0.5）
- **FR-012**: 系统 MUST 为按钮点击提供触觉反馈（Haptic Feedback - Light Impact）和视觉反馈（背景色变化 0.1s）
- **FR-013**: 系统 MUST 在列表滚动、动画执行时保持 ≥60fps 帧率（Constitution Principle V）
- **FR-014**: 系统 MUST 为删除操作提供撤销选项（iOS 标准模式：底部 Toast 提示 + 撤销按钮，5s 超时）

#### 毛玻璃与材质要求

- **FR-015**: 系统 MUST 为浮层组件（底部面板、对话框、菜单）使用毛玻璃背景（UIBlurEffect - systemMaterial）
- **FR-016**: 毛玻璃效果 MUST 实时反映背后内容的模糊（高斯模糊半径 20-30pt），而非静态半透明遮罩
- **FR-017**: 系统 MUST 在低端设备（如 iPhone 8 或更低）上检测性能，若帧率<45fps 则降级为半透明纯色背景
- **FR-018**: 系统 MUST 在用户开启"减少透明度"辅助功能时，禁用毛玻璃效果，改用不透明卡片背景

#### 可访问性与无障碍要求

- **FR-019**: 系统 MUST 支持 Dynamic Type，所有文字使用语义化字号（如 `typography.fontSize.body`），可随系统设置放大（Constitution Principle I）
- **FR-020**: 系统 MUST 为所有交互元素提供 VoiceOver 标签（如"删除支出记录"），标签描述准确清晰（Constitution Principle IV）
- **FR-021**: 所有可点击元素 MUST 满足最小触摸区域 44x44pt（Constitution Principle IV）
- **FR-022**: 系统 MUST 在用户开启"增强对比度"时，提高边框线、分隔线的对比度（从 10% 不透明度提升至 30%）

#### 布局与响应式要求

- **FR-023**: 系统 MUST 使用 Safe Area 布局，确保内容不被刘海、圆角、底部指示器遮挡（Constitution Principle VII）
- **FR-024**: 系统 MUST 在 iPad 上适配布局，卡片最大宽度为 600pt，超过则居中显示并增加左右边距
- **FR-025**: 列表内容 MUST 使用 FlatList 优化性能（移除屏幕外视图，按批次渲染），单批次渲染≤10 项（Constitution Principle V）

#### 组件视觉规范

- **FR-026**: 交易卡片 MUST 包含：左侧分类图标（48x48pt 圆形）、中间详情（分类名、备注、时间）、右侧金额（粗体红色/绿色）
- **FR-027**: 分类图标 MUST 使用彩色圆形背景（分类主题色）+ 白色图标，圆形边缘无描边
- **FR-028**: 金额文字 MUST 使用 Tabular Nums（等宽数字），避免数字跳动，字重为 700（Semibold）
- **FR-029**: 时间戳 MUST 使用相对时间格式（如"2 小时前"），颜色为三级文字色（`colors.textTertiary`）
- **FR-030**: FAB MUST 使用 56x56pt 圆形按钮（主题色背景 + 白色图标），悬浮于右下角，距底部和右侧各 16pt（考虑 Safe Area）

### Key Entities

- **视觉主题（Theme）**: 包含 colors（颜色语义表）、typography（字体规范）、spacing（间距系统）、shadows（阴影定义）等，支持浅色/深色模式动态切换
- **动画配置（AnimationConfig）**: 定义标准动画时长（快速 0.2s、标准 0.35s、慢速 0.5s）、缓动曲线（ease-in-out、spring）、弹簧参数（阻尼、响应度）
- **毛玻璃材质（BlurMaterial）**: 定义不同场景的模糊效果强度（light、regular、prominent），包含降级策略（性能不足时禁用）
- **卡片样式（CardStyle）**: 统一的卡片组件样式定义，包括圆角、阴影、内边距、背景色（浅色/深色变体）

## Success Criteria *(mandatory)*

### Measurable Outcomes

#### 视觉质量指标

- **SC-001**: 100% 的 UI 元素使用 8pt 网格系统对齐，通过设计稿标注工具（如 Figma Measure）验证
- **SC-002**: 所有文字与背景对比度 ≥4.5:1（标准）或 ≥7:1（小号），通过 Accessibility Inspector 验证 0 违规项
- **SC-003**: 深色模式下，所有界面元素正确适配，无硬编码浅色残留，通过视觉回归测试验证

#### 性能指标

- **SC-004**: 列表滚动帧率 ≥60fps（在 iPhone 12 或更新设备），通过 Xcode Instruments 或 React Native Profiler 验证
- **SC-005**: 毛玻璃效果启用时，帧率 ≥55fps（中端设备），低端设备（iPhone 8）自动降级为纯色背景
- **SC-006**: 页面过渡动画完成时间 ≤0.4s，无卡顿或丢帧现象

#### 交互体验指标

- **SC-007**: 用户执行"添加交易"操作的平均完成时间 ≤25s（包含动画时间），比改版前提升 15%
- **SC-008**: 用户在首次使用时，对界面美观度的满意度评分 ≥4.2/5（通过问卷调查）
- **SC-009**: 90% 的用户能在无提示的情况下正确识别和使用 FAB、筛选按钮、卡片滑动删除功能

#### 无障碍指标

- **SC-010**: 100% 的交互元素通过 VoiceOver 导航测试，标签描述清晰准确
- **SC-011**: 支持 Dynamic Type 最大字号（XXXL）时，界面无截断、重叠或布局错乱
- **SC-012**: 在"增强对比度"和"减少透明度"模式下，界面可用性不受影响，功能完整

#### 技术质量指标

- **SC-013**: 视觉改版相关代码测试覆盖率 ≥85%（组件渲染、主题切换、动画逻辑）
- **SC-014**: 0 个硬编码颜色值残留在业务代码中（通过 ESLint 规则检测），所有颜色通过 `useTheme` 引用
- **SC-015**: 改版后应用包大小增量 ≤500KB（优化图标资源，使用矢量图标）

#### 业务影响指标

- **SC-016**: 改版后 7 天内，用户日均使用时长提升 ≥10%（通过分析工具统计）
- **SC-017**: 用户对应用的 App Store 评分从当前 X.X 提升至 ≥4.5（目标周期 30 天）
- **SC-018**: 新用户留存率（次日留存）提升 ≥8%，归因于视觉吸引力增强

## Assumptions

1. **技术栈延续**: 项目继续使用 React Native + Expo，不涉及原生重写，毛玻璃效果通过 `expo-blur` 或 `react-native-blur` 实现
2. **设计资源**: 假设有设计师提供 Figma 设计稿，包含浅色/深色模式完整视觉规范和切图资源
3. **字体授权**: San Francisco 字体仅在 iOS 平台可用，Android 使用 Roboto 作为等效替代（系统默认）
4. **性能基线**: 改版针对 iPhone 8 及以上设备优化，更老设备（如 iPhone 6s）可能需要禁用部分动画
5. **用户习惯**: 用户已熟悉当前版本的交互逻辑（如 FAB、筛选面板），改版仅调整视觉不改变交互流程
6. **深色模式默认**: 假设 80% 用户在晚间使用记账应用，深色模式的优化优先级高于浅色模式
7. **图标资源**: 使用 Ionicons 图标库（Expo 内置），风格接近 SF Symbols，无需额外引入图标库
8. **动画库**: 使用 Reanimated 3 实现高性能动画，替换原有的 Animated API（如尚未迁移）
9. **辅助功能测试**: 假设有真实设备测试环境（至少 1 台 iPhone 和 1 台 Android 设备），能验证 VoiceOver 和 TalkBack
10. **版本兼容**: 改版后应用最低支持 iOS 13（支持 Dark Mode）和 Android 10，放弃对更老系统的优化

## Out of Scope

以下内容**不在**本次改版范围内：

1. **交互逻辑重构**: 不改变现有的筛选逻辑、CRUD 操作流程、导航结构，仅调整视觉呈现
2. **新功能开发**: 不添加新的统计图表类型、预算管理、多账户等功能，专注于现有功能的视觉优化
3. **数据模型变更**: 不修改 Expense、Category 等数据结构，不涉及数据库迁移
4. **后端服务**: 不涉及云端同步、用户账户系统等后端开发
5. **品牌重塑**: 不改变应用名称、Logo、启动页，仅优化内部界面的视觉风格
6. **国际化扩展**: 不新增多语言支持（如已有则保持），文案内容不做调整
7. **平板专属设计**: iPad 适配仅做基础响应式调整（如最大宽度限制），不开发专属的分栏布局
8. **3D 效果**: 不实现复杂的 3D 视差效果（如 iOS 锁屏壁纸），仅做 2D 平面动画优化
9. **自定义手势**: 不新增手势（如双击、长按特殊功能），保持现有的点击和滑动删除即可
10. **性能监控系统**: 不引入 APM 工具（如 Sentry Performance），性能验证通过开发工具手动测试

## Notes

- **设计参考**: 本规格基于 Apple iOS 26 的 Liquid Glass 设计语言，强调通透、连贯、动态适应的视觉风格
- **渐进式实施**: 建议按优先级实施用户故事（P1 -> P2 -> P3），每个阶段完成后可独立发布体验版
- **A/B 测试建议**: 改版后可通过 A/B 测试对比新旧版本的用户留存、使用时长等指标，验证视觉改版的业务价值
- **设计走查**: 实施前建议组织设计走查会议，确保开发团队理解 iOS HIG 的核心原则（如 Dynamic Type、Safe Area）
- **真机测试必要性**: 毛玻璃效果和动画性能必须在真机上验证，模拟器无法准确反映实际体验
